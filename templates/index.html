<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Wildfire Defenders</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@200..900&family=Sigmar+One&display=swap');
    
    * {
      box-sizing: border-box;
    }
    
    body { 
      font-family: "Sigmar One", sans-serif;
      font-weight: 400;
      font-style: normal;
      background: #e6ffe6;
      margin: 0; 
      padding: 0; 
      color: #3F2A2B;
      overflow: hidden;
    }
    
    .page { 
      display: none; 
      height: 100vh; 
      width: 100vw;
      justify-content: center; 
      align-items: center; 
      flex-direction: column; 
      padding: 0; 
      overflow: hidden;
    } 
    
    #startPage {
      background-image: url('static/images/introBackground.gif');
      background-repeat: no-repeat;
      background-position: center center;
      background-size: cover;
    }
    
    #gamePage {
      background-image: url('static/images/Background.jpg');
      background-size: cover;
      background-position: center;
      flex-direction: column;
      padding: 0;
    }
    
    .content {
      background: #d8808051;
      height: 100vh;
      width: 100vw;
      display: grid;
      grid-template-rows: 1fr auto 1fr;
      place-items: center;
    }

    .logo {
      grid-row: 2;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .startButton {
      grid-row: 3;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding-top: 50px;
    }
    
    /* Menu Page Styling */
    #menuPage {
      padding: 40px;
      background: linear-gradient(135deg, #e6ffe6 0%, #d4f4d4 100%);
    }
    
    .menu-container {
      max-width: 1200px;
      width: 100%;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 60px;
      margin: 20px 0 40px 0;
    }
    
    .menu-section {
      background: rgba(216, 195, 128, 0.15);
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(5px);
    }
    
    .menu-section h2 {
      color: #2d5a3d;
      margin-bottom: 15px;
      font-size: 24px;
      border-bottom: 2px solid #D8C380;
      padding-bottom: 10px;
    }
    
    .menu-section p {
      color: #3F2A2B;
      font-family: 'Arial', sans-serif;
      font-size: 16px;
      line-height: 1.6;
      margin-bottom: 15px;
    }
    
    .menu-buttons {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin-top: 30px;
    }
    
    /* Map Page Styling */
    #mapPage {
      padding: 40px;
      background: linear-gradient(135deg, #e6ffe6 0%, #d4f4d4 100%);
    }
    
    .map-container {
      max-width: 800px;
      width: 100%;
      margin: 30px 0;
    }
    
    .map-buttons {
      display: flex;
      flex-direction: column;
      gap: 20px;
      margin: 30px 0;
    }
    
    /* Game Menu Bar */
    .game-menu-bar {
      width: 100%;
      height: 60px;
      background: rgba(63, 42, 43, 0.9);
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      z-index: 1000;
    }
    
    .menu-left, .menu-right {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    
    .game-info {
      color: #D8C380;
      font-size: 16px;
    }
    
    .menu-button {
      padding: 8px 16px;
      font-size: 14px;
      border-radius: 5px;
      border: none;
      cursor: pointer;
      background-color: #D8C380;
      color: #3F2A2B;
      font-family: "Sigmar One", sans-serif;
      transition: all 0.3s ease;
    }
    
    .menu-button:hover {
      background-color: #1f5d3d;
      color: white;
    }
    
    #p5host {
      flex: 1;
      width: 100%;
      margin: 0;
    }
    
    button { 
      margin: 5px; 
      padding: 18px 26px; 
      font-size: 18px; 
      border-radius: 8px; 
      border: none; 
      cursor: pointer; 
      background-color: #D8C380;
      color: white; 
      transition: all 0.3s ease;
      font-family: "Sigmar One", sans-serif;
      font-weight: 400;
      font-style: normal;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
    }
    
    button:hover { 
      background-color: #1f5d3d; 
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
    }
    
    .large-button {
      font-size: 50px;
      padding: 25px 40px;
    }
    
    h1 { 
      color: #2d5a3d; 
      font-size: 36px;
      margin-bottom: 20px;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    h2 { 
      color: #3F2A2B; 
    }
    
    .active { 
      display: flex; 
    }
  </style>
  <!-- p5.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.js"></script>
  <!-- your sketch -->
  <script src="{{ url_for('static', filename='js/sketch.js') }}"></script>
  <!-- ml5.js -->
  <script src="https://unpkg.com/ml5@latest/dist/ml5.min.js"></script>
</head>
<body>
  <!-- Starter Page -->
  <div id="startPage" class="page active">
    <div class="content">
      <div class="logo">
        <img src="{{ url_for('static', filename='images/LOGO.png') }}" alt="Wildfire Defenders Logo" 
             style="width: 900px; max-width: 90vw;">
      </div>
      <div class="startButton">
        <button onclick="showPage('menuPage')" class="large-button">Start</button>
      </div>
    </div>
  </div>

  <!-- Menu Page -->
  <div id="menuPage" class="page">
    <h1>Main Menu</h1>
    <div class="menu-container">
      <div class="menu-section">
        <h2>üéÆ How to Play</h2>
        <p>Move by saying the words "UP", "DOWN","LEFT","RIGHT","STOP"</p>
        <p>Stand on fires and pull on fire hose lever to extinguish them.</p>
        <p>When smoke appears make sure to blow it out by blowing into the front of the water hose!</p>
      </div>
      
      <div class="menu-section">
        <h2>üéØ Controller Guide</h2>
        <p>The water hose has 2 pressure levels. Pull on the lever half</p>
        <p>way to release some water, and pull all the way to release full amount of water. </p>
        <p>Blow into the front of the hose to blow out flames OR smoke.</p>
      </div>
      
      <div class="menu-section">
        <h2>üå≤ Forest Conservation</h2>
        <p>Forests are vital ecosystems that support countless species and help regulate our climate.</p>
        <p>Wildfires can be devastating, but proper fire safety measures and quick response can protect these precious environments.</p>
        <p>Every tree saved makes a difference!</p>
      </div>
      
      <div class="menu-section">
        <h2>üë• About Our Mission</h2>
        <p>We are a dedicated team passionate about fire safety education and environmental protection.</p>
        <p>Through interactive gaming, we aim to raise awareness about wildfire prevention and forest conservation.</p>
        <p>Join us in becoming a Wildfire Defender!</p>
      </div>
    </div>
    
    <div class="menu-buttons">
      <button onclick="connect()" class="large-button">Connect Controller</button>
      <button onclick="showPage('mapPage')">üéÆ Play Game</button>
      <button onclick="goBack()">‚¨Ö Back</button>
    </div>
  </div>

  <!-- Map Selection Page -->
  <div id="mapPage" class="page">
    <h1>Select Your Mission</h1>
    <div class="map-container">
      <div class="menu-section">
        <h2>üå≥ Available Forests</h2>
        <p>Choose your battlefield and help protect these vital ecosystems from devastating wildfires.</p>
        <p>Each forest presents unique challenges and requires different strategies to save.</p>
      </div>
      
      <div class="map-buttons">
        <button onclick="startGame('Amazon Rain Forest')" style="font-size: 24px; padding: 20px 30px;">
          üå≥ Amazon Rain Forest
        </button>
        <!-- Add more forest options here -->
      </div>
    </div>
    
    <button onclick="goBack()">‚¨Ö Back to Menu</button>
  </div>

  <!-- Game Page -->
  <div id="gamePage" class="page">
    <!-- Game Menu Bar -->
    <div class="game-menu-bar">
      <div class="menu-left">
        <div class="game-info" id="mapName">Amazon Rain Forest</div>
        <div class="game-info" id="gameStats">Fires: 0 | Score: 0</div>
      </div>
      <div class="menu-right">
        <button class="menu-button" onclick="pauseGame()">‚è∏ Pause</button>
        <button class="menu-button" onclick="showHelp()">‚ùì Help</button>
        <button class="menu-button" onclick="goBack()">üè† Menu</button>
      </div>
    </div>
    
    <!-- Game Canvas Container -->
    <div id="p5host"></div>
  </div>

  <script>
    let historyStack = [];

    function showPage(id) {
      const current = document.querySelector('.page.active');
      if (current) {
        historyStack.push(current.id);
        current.classList.remove('active');
      }
      document.getElementById(id).classList.add('active');
    }

    function goBack() {
      const current = document.querySelector('.page.active');
      if (current) current.classList.remove('active');

      const prev = historyStack.pop();
      if (prev) {
        document.getElementById(prev).classList.add('active');
      } else {
        document.getElementById("startPage").classList.add('active');
      }
    }

    function startGame(map) {
      window.selectedMap = map;
      document.getElementById("mapName").textContent = map;
      showPage('gamePage');

      // Remove old game if it exists
      if (window.currentGame) {
        window.currentGame.remove();
      }
      // Start new game
      window.currentGame = new p5(gameSketch, "p5host");
    }
    
    // Game menu functions
    function pauseGame() {
      // Add pause functionality here
      console.log("Game paused");
    }
    
    function showHelp() {
      alert("Controls:\n‚Ä¢ Arrow keys or controller to move\n‚Ä¢ Stand on fires and press the correct button\n‚Ä¢ Save the forest by extinguishing all fires!");
    }
    
    // Optional: Update game stats
    function updateGameStats(fires, score) {
      document.getElementById("gameStats").textContent = `Fires: ${fires} | Score: ${score}`;
    }
    
    // Optional: Connect function placeholder
    async function connect(){
      try{
        port = await navigator.serial.requestPort();
        await port.open({ baudRate: 115200 });
        isConnected = true;
        readUART();
      } catch (error){
        console.log(error);
      }
    }
  </script>
</body>
</html>